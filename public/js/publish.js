// Generated by CoffeeScript 1.3.1

define(function() {
  return (function($) {
    var ps, publish, subscribe, unsubscribe;
    ps = $({});
    publish = function() {
      return ps.trigger.apply(ps, arguments);
    };
    subscribe = function() {
      return ps.on.apply(ps, arguments);
    };
    unsubscribe = function() {
      return ps.off.apply(ps, arguments);
    };
    $.fn.publish = function(topic, data) {
      console.log("'" + (this.prop('id')) + "' publishing data", data, "to topic '" + topic + "'");
      publish(topic, [this, data]);
      return this;
    };
    $.fn.subscribe = function(topics, cb) {
      console.log("'" + (this.prop('id')) + "' subscribing to topics '" + topics + "'");
      subscribe(topics, this, function(e, publisher, data) {
        var pubID, result, subID, subscriber;
        pubID = publisher.prop('id');
        subscriber = e.data;
        subID = subscriber.prop('id');
        if (pubID !== subID) {
          result = cb.apply(subscriber, data);
          if (result !== false) {
            subscriber.trigger('_', [result]);
          }
          return console.log("Subscription handled: '" + pubID + "' > '" + subID + "', topic '" + topics + "', data", data);
        } else {
          return console.log("Subscription not handled: '" + pubID + "' > '" + subID + "', topic '" + topics + "', data", data);
        }
      });
      return this;
    };
    return $.fn.unsubscribe = function(topics) {
      unsubscribe(topics);
      return this;
    };
  })(jQuery);
});
