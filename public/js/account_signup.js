// Generated by CoffeeScript 1.3.1
var accounts;

if (!(typeof accounts !== "undefined" && accounts !== null)) {
  accounts = [];
}

define(['eg/eg_api', 'plugin'], function(eg) {
  return (function($) {
    var content, deferreds;
    content = '<form name="signup" class="signup" method="post" action="/signup">\n  <div data-role="fieldcontain">\n    <label for="first_name">Your first name:</label>\n    <input name="first_name" id="first_name" type="text" />\n  </div>\n  <div data-role="fieldcontain">\n    <label for="last_name">Your last name:</label>\n    <input name="last_name" id="last_name" type="text" />\n  </div>\n  <div data-role="fieldcontain">\n    <label for="email">Email:</label>\n    <input name="email" id="email" type="text" />\n  </div>\n  <div data-role="fieldcontain">\n    <label for="password">Password:</label>\n    <input name="password" id="password" type="password" />\n  </div>\n  <div class="ui-grid-a">\n    <div class="ui-block-a">\n      <button type="reset">Cancel</button>\n    </div>\n    <div class="ui-block-b">\n      <button type="submit" class="submit">Create account</button>\n    </div>\n  </div>\n</form>\n<a href="/auth/facebook">Login with Facebook</a>';
    deferreds = [];
    return $.fn.account_signup = function() {
      var $account_signup, cancel,
        _this = this;
      if (this.plugin()) {
        return this;
      }
      $account_signup = this.plugin('account_signup');
      this.find('.content').html(content).trigger('refresh');
      return this.on('submit', 'form[name="signup"]', function() {
        $.ajax({
          url: '/signup',
          type: 'POST',
          data: {
            firstName: $('form.signup input[name="first_name"]').val(),
            lastName: $('form.signup input[name="last_name"]').val(),
            email: $('form.signup input[name="email"]').val(),
            password: $('form.signup input[name="password"]').val()
          },
          success: function(data) {
            var _this = this;
            console.log("account successfully created");
            $('form.signup input').val('').end();
            require(['manage_account'], function() {
              return $('#card_list').manage_account();
            });
            $.mobile.changePage("#manage_account");
          },
          error: function(data) {
            console.log("there was an error");
            console.log(data);
            return $().publish('notice', [data.responseText]);
          }
        });
        return false;
      }).on('click', 'button[type=reset]', cancel = function() {
        $.mobile.changePage("/");
        _this.find('input[name=email]').val('').end();
        _this.find('input[name=password]').val('').end();
        deferreds = [];
        return false;
      }).on('keyup', 'input', function(e) {
        switch (e.keyCode) {
          case 27:
            cancel.call(_this);
        }
        return false;
      });
    };
  })(jQuery);
});
