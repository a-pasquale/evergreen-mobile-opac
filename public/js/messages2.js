// Generated by CoffeeScript 1.3.1

define(['jqm_sd', 'plugin'], function() {
  return (function($) {
    var close_notice, notably, open_notice, open_prompt, promptly, the_message;
    the_message = function(msg) {
      switch (false) {
        case !!(msg != null):
          return '';
        case typeof msg !== 'string':
          return msg;
        case msg.desc == null:
          return msg.desc;
        default:
          return JSON.stringify(msg);
      }
    };
    notably = {
      mode: 'blank',
      top: true,
      width: '80%'
    };
    open_notice = function(text) {
      return $('<div>').simpledialog2($.extend({}, notably, {
        blankContent: "<h3 class='message'>" + text + "</h3>"
      }));
    };
    close_notice = function() {
      return $.mobile.sdCurrentDialog.close();
    };
    promptly = {
      headerClose: true,
      animate: false
    };
    open_prompt = function(type, text) {
      $('<div>').simpledialog2($.extend({}, notably, promptly, {
        headerText: type,
        blankContent: "<h3 class='message'>" + text + "</h3>"
      }));
    };
    /*
    	open_notice = (text) ->
    		$('#messages').html("<h3 class='message'>#{text}</h3>").trigger 'create'
    		$.mobile.changePage '#messages', transition: 'pop', role: 'dialog'
    	open_prompt = (type, text) ->
    		$('#messages').html("<h3 class='message'>#{type}</h3>").trigger 'create'
    		$.mobile.changePage '#messages', transition: 'pop', role: 'dialog'
    	close_notice = -> $('#messages').dialog 'close'
    */

    return $.fn.messages = function() {
      return this.plugin('messages').subscribe('notice', function(xs) {
        var x, _i, _len;
        if (!$.isArray(xs)) {
          xs = [xs];
        }
        for (_i = 0, _len = xs.length; _i < _len; _i++) {
          x = xs[_i];
          open_notice(the_message(x));
        }
        setTimeout(close_notice, 2000);
        return false;
      }).subscribe('prompt', function(type, xs) {
        var x, _i, _len;
        if (!$.isArray(xs)) {
          xs = [xs];
        }
        for (_i = 0, _len = xs.length; _i < _len; _i++) {
          x = xs[_i];
          open_prompt(type, the_message(x));
        }
        return false;
      });
    };
  })(jQuery);
});
